<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2018 ACSONE SA/NV
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl). -->
<odoo>
    <template
        id="report_invoice_document_margin_tax"
        inherit_id="account.report_invoice_document"
        priority="99"
    >
        <xpath expr="//t[@t-set='lines']" position="replace">
            <t
                t-set="lines"
                t-value="o.invoice_report_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"
            />
        </xpath>
        <xpath
            expr="//t[@t-value='current_subtotal + line.price_subtotal']"
            position="attributes"
        >
            <attribute
                name="t-value"
            >current_subtotal + line.price_subtotal_report</attribute>
        </xpath>
        <xpath expr="//span[@t-field='line.price_subtotal']" position="attributes">
            <attribute name="t-field">line.price_subtotal_report</attribute>
        </xpath>
<!--        <span class="text-nowrap" t-field="line.price_unit"/>-->
        <xpath expr="//span[@t-field='line.price_unit']" position="replace">
            <span class="text-nowrap" t-field="line.price_unit_report" />
        </xpath>
    </template>
</odoo>
